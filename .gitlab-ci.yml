stages:
  - build
  - unit tests
  - publish

build:
  stage: build
  script:
    - dotnet build Exprest.sln

unit_tests:
  stage: unit tests
  before_script:
    - echo "Normal build -- running unit tests..."
    - chcp 65001
    # uncomment to install the required tools --
    # dotnet tool install -g trx2junit
  script:
    # building again the solution
    - dotnet test Exprest.sln --logger "trx;LogFileName=TestResults.trx"
    - echo Converting test results
    - trx2junit Exprest.Tests\TestResults\TestResults.trx
  artifacts:
    paths:
      - Exprest.Tests\TestResults\TestResults.trx
    reports:
      junit:
        - Exprest.Tests\TestResults\TestResults.xml
    expire_in: 1 day

publish:
  stage: publish
  script:
    - dotnet pack -c Release Exprest.sln
  artifacts:
    paths:
      - Exprest\bin\Release\*.nupkg
      - Exprest\bin\Release\*.snupkg
